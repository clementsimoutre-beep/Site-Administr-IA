<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plomberie Dutuyau - Devis en ligne</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800;900&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: #000; color: #fff;
            padding-top: 100px; padding-bottom: 60px;
        }

        /* NAVIGATION */
        nav {
            position: fixed; top: 0; width: 100%; padding: 20px 60px;
            display: flex; justify-content: space-between; align-items: center;
            z-index: 1000; background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .logo {
            font-size: 24px; font-weight: 800;
            background: linear-gradient(135deg, #00f5ff 0%, #0099ff 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            cursor: pointer;
        }
        .nav-links { display: flex; gap: 30px; align-items: center; }
        .nav-links a {
            color: #fff; text-decoration: none; font-weight: 500; font-size: 15px;
            transition: all 0.3s; opacity: 0.7;
        }
        .nav-links a:hover, .nav-links a.active { opacity: 1; color: #00f5ff; }
        .nav-links .cta-btn {
            background: linear-gradient(135deg, #00f5ff 0%, #0099ff 100%);
            padding: 10px 24px; border-radius: 50px; opacity: 1; color: #fff;
        }

        /* CALCULATOR */
        .calculator-container {
            max-width: 1200px; margin: 0 auto;
            background: rgba(255, 255, 255, 0.03); padding: 50px;
            border-radius: 32px; border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
        }
        h1 {
            text-align: center; font-size: 42px; margin-bottom: 40px;
            background: linear-gradient(135deg, #fff 0%, #00f5ff 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        .step-title { font-size: 26px; color: #00f5ff; margin-bottom: 20px; font-weight: 700; }
        .step-subtitle { 
            font-size: 18px; color: #aaa; margin-bottom: 20px; 
            border-bottom: 1px solid rgba(255, 255, 255, 0.1); padding-bottom: 10px; 
            font-weight: 600;
        }

        .options-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-bottom: 30px;
        }
        /* Nouvelle structure pour les options par gamme */
        .option-group {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            padding: 20px; border-radius: 16px; transition: 0.3s;
            display: flex; flex-direction: column;
        }
        .option-group:hover {
            border-color: rgba(0, 245, 255, 0.3);
        }
        .option-group h3 {
            font-size: 18px; margin-bottom: 15px; font-weight: 600;
        }
        .gamme-choice {
            display: flex; flex-direction: column; gap: 8px; flex-grow: 1;
        }
        .gamme-item {
            display: flex; justify-content: space-between; align-items: center; cursor: pointer;
            padding: 10px 12px; border-radius: 8px; border: 1px solid transparent;
            background: rgba(0, 245, 255, 0.05); transition: 0.2s;
            font-size: 14px;
        }
        .gamme-item:hover {
            background: rgba(0, 245, 255, 0.15);
        }
        .gamme-item.selected {
            border-color: #00f5ff;
            background: rgba(0, 245, 255, 0.2);
        }
        /* Style sp√©cifique pour le bouton "Non Souhait√© / Existant" */
        .non-souhaite .gamme-label, .non-souhaite .gamme-price {
            opacity: 0.8; font-style: italic;
        }
        .non-souhaite.selected {
            border-color: #555;
            background: rgba(255, 255, 255, 0.1);
        }
        .gamme-item input[type="radio"] {
            display: none; /* Cache le bouton radio natif pour utiliser le style .selected */
        }
        .gamme-label {
            flex-grow: 1; line-height: 1.4;
        }
        .gamme-price {
            font-weight: 700;
            white-space: nowrap; /* Emp√™che le prix de se couper */
            text-align: right;
        }
        .gamme-details {
            font-size: 12px;
            color: #ccc;
            display: block;
        }


        /* Style pour l'√©tape 1 (unique) - P√©rim√®tre */
        .option-card {
            background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1);
            padding: 20px; border-radius: 12px; cursor: pointer; text-align: center; transition: 0.3s;
        }
        .option-card.selected { 
            border-color: #00f5ff; 
            background: rgba(0, 245, 255, 0.1); 
        }
        .perimetre-tag { 
            color: #fff; 
            font-weight: 600; 
            margin-top: 5px; 
            display: block;
            font-size: 14px;
            opacity: 0.8;
        }


        .total-box {
            text-align: center; margin-top: 50px; padding: 40px;
            background: rgba(0, 245, 255, 0.05); border-radius: 20px; border: 1px solid #00f5ff;
        }
        .total-price { font-size: 48px; font-weight: 900; color: #00f5ff; }

        .cta-button {
            background: #fff; color: #000; padding: 15px 40px; border: none;
            border-radius: 50px; text-decoration: none; font-weight: bold;
            cursor: pointer; transition: background-color 0.3s, transform 0.2s;
            margin-top: 30px; font-size: 18px;
        }
        .cta-button:hover {
             background: #eee; transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            nav { padding: 20px; }
            .nav-links a:not(.cta-btn) { display: none; }
            .calculator-container { padding: 20px; margin: 20px; }
            .options-grid { grid-template-columns: 1fr; }
            h1 { font-size: 32px; }
            .step-title { font-size: 22px; }
        }
    </style>
</head>
<body>

    <nav>
        <div class="logo" onclick="window.location.href='index.html'">üíß Plomberie Dutuyau</div>
        <div class="nav-links">
            <a href="index.html">Accueil</a>
            <a href="realisations.html">Nos R√©alisations</a>
            <a href="devis.html" class="active">Devis en ligne</a>
            <a href="intervention.html" class="cta-btn">Demande d'intervention</a>
        </div>
    </nav>

    <div class="calculator-container">
        <h1>Simulateur de Devis (Plomberie & Sanitaire)</h1>

        <!-- Step 1: P√©rim√®tre d'Intervention (Single Select / Radio) -->
        <div class="step">
            <div class="step-title">1. P√©rim√®tre de l'Intervention</div>
            <p class="step-subtitle">S√©lectionnez la zone principale pour d√©finir le contexte de nos travaux (prix initial de base ramen√© √† 0‚Ç¨)</p>
            <div class="options-grid" id="typeGrid">
                <!-- Les prix ici sont √† 0‚Ç¨, ils d√©finissent le p√©rim√®tre, pas le co√ªt -->
                <div class="option-card selected" data-name="R√©novation Salle de Bain Compl√®te" data-price="0" onclick="selectType(this, 0)">
                    <div>üíé R√©novation Salle de Bain Compl√®te</div>
                    <span class="perimetre-tag">D√©finit le contexte SDB</span>
                </div>
                <div class="option-card" data-name="R√©novation Cuisine Compl√®te" data-price="0" onclick="selectType(this, 0)">
                    <div>üç≥ R√©novation Cuisine Compl√®te</div>
                    <span class="perimetre-tag">D√©finit le contexte Cuisine</span>
                </div>
                <div class="option-card" data-name="Installation Plomberie Neuve (Maison)" data-price="0" onclick="selectType(this, 0)">
                    <div>üè† Installation Plomberie Neuve</div>
                    <span class="perimetre-tag">D√©finit le contexte Neuf / Gros ≈íuvre</span>
                </div>
                <div class="option-card" data-name="Remplacement Chauffe-Eau Seul" data-price="0" onclick="selectType(this, 0)">
                    <div>üî• Remplacement Chauffe-Eau Seul</div>
                    <span class="perimetre-tag">D√©finit le contexte ECS uniquement</span>
                </div>
                <!-- Nouveaux projets -->
                <div class="option-card" data-name="R√©am√©nagement Espace WC/Lavabo" data-price="0" onclick="selectType(this, 0)">
                    <div>üöΩ R√©am√©nagement WC/Lavabo</div>
                    <span class="perimetre-tag">D√©finit le contexte Pi√®ce d'eau secondaire</span>
                </div>
                <div class="option-card" data-name="Cr√©ation Point d'Eau (Lave-Linge/√âvier)" data-price="0" onclick="selectType(this, 0)">
                    <div>üß∫ Cr√©ation Arriv√©e/√âvacuation</div>
                    <span class="perimetre-tag">D√©finit le contexte Point d'eau isol√©</span>
                </div>
            </div>
        </div>
        
        <!-- Step 2: Options D√©taill√©es avec Mat√©riel + Main d'≈ìuvre -->
        <div class="step" style="margin-top: 50px;">
            <div class="step-title">2. Choix des Modules et Forfaits de Pose</div>
            <p class="step-subtitle">Chaque prix inclut : le co√ªt du Mat√©riel (Fourniture) + le Forfait Main-d'≈ìuvre (Pose & Raccordement)</p>

            <div class="step-subtitle">WC, Vasques, √âvacuations et Gaz</div>
            <div class="options-grid">
                <!-- Option 1: WC (M: Mat√©riel / MO: Main d'≈ìuvre) -->
                <div class="option-group">
                    <h3>WC (Fourniture & Pose)</h3>
                    <div class="gamme-choice" data-category="WC">
                        <label class="gamme-item non-souhaite selected" data-m="0" data-mo="0">
                            <input type="radio" name="WC" value="Non Souhait√©" checked onchange="selectModule(this, 0, 0)">
                            <span class="gamme-label">Non souhait√© / Conservation de l'existant</span>
                            <span class="gamme-price">0‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="250" data-mo="250">
                            <input type="radio" name="WC" value="Sur pied Standard" onchange="selectModule(this, 250, 250)">
                            <span class="gamme-label">WC Sur pied Standard (M: 250‚Ç¨ + MO: 250‚Ç¨)
                                <span class="gamme-details">Total : 500‚Ç¨</span>
                            </span>
                            <span class="gamme-price">500‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="550" data-mo="450">
                            <input type="radio" name="WC" value="Suspendu Standard" onchange="selectModule(this, 550, 450)">
                            <span class="gamme-label">WC Suspendu (M: 550‚Ç¨ + MO: 450‚Ç¨)
                                <span class="gamme-details">Total : 1 000‚Ç¨</span>
                            </span>
                            <span class="gamme-price">1 000‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="1000" data-mo="500">
                            <input type="radio" name="WC" value="Japonais" onchange="selectModule(this, 1000, 500)">
                            <span class="gamme-label">WC Japonais / Lavant (M: 1 000‚Ç¨ + MO: 500‚Ç¨)
                                <span class="gamme-details">Total : 1 500‚Ç¨</span>
                            </span>
                            <span class="gamme-price">1 500‚Ç¨</span>
                        </label>
                    </div>
                </div>
                 <!-- Option 2: Lavabo/Vasque -->
                 <div class="option-group">
                    <h3>Meuble Vasque (Fourniture & Pose)</h3>
                    <div class="gamme-choice" data-category="VASQUE">
                        <label class="gamme-item non-souhaite selected" data-m="0" data-mo="0">
                            <input type="radio" name="VASQUE" value="Non Souhait√©" checked onchange="selectModule(this, 0, 0)">
                            <span class="gamme-label">Non souhait√© / Conservation de l'existant</span>
                            <span class="gamme-price">0‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="350" data-mo="250">
                            <input type="radio" name="VASQUE" value="Meuble Simple" onchange="selectModule(this, 350, 250)">
                            <span class="gamme-label">Meuble simple (M: 350‚Ç¨ + MO: 250‚Ç¨)
                                <span class="gamme-details">Total : 600‚Ç¨</span>
                            </span>
                            <span class="gamme-price">600‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="600" data-mo="300">
                            <input type="radio" name="VASQUE" value="Vasque √† Poser" onchange="selectModule(this, 600, 300)">
                            <span class="gamme-label">Vasque √† poser (M: 600‚Ç¨ + MO: 300‚Ç¨)
                                <span class="gamme-details">Total : 900‚Ç¨</span>
                            </span>
                            <span class="gamme-price">900‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="900" data-mo="400">
                            <input type="radio" name="VASQUE" value="Double Vasque" onchange="selectModule(this, 900, 400)">
                            <span class="gamme-label">Meuble Double Vasque (M: 900‚Ç¨ + MO: 400‚Ç¨)
                                <span class="gamme-details">Total : 1 300‚Ç¨</span>
                            </span>
                            <span class="gamme-price">1 300‚Ç¨</span>
                        </label>
                    </div>
                </div>
                 <!-- Option 3: Raccordement Cuisine -->
                <div class="option-group">
                    <h3>Raccordement Cuisine (√âvier/Appareils)</h3>
                    <div class="gamme-choice" data-category="CUISINE">
                        <label class="gamme-item non-souhaite selected" data-m="0" data-mo="0">
                            <input type="radio" name="CUISINE" value="Non Souhait√©" checked onchange="selectModule(this, 0, 0)">
                            <span class="gamme-label">Non souhait√© (Pas de cuisine)</span>
                            <span class="gamme-price">0‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="50" data-mo="300">
                            <input type="radio" name="CUISINE" value="Simple" onchange="selectModule(this, 50, 300)">
                            <span class="gamme-label">√âvier simple + 1 appareil (M: 50‚Ç¨ + MO: 300‚Ç¨)
                                <span class="gamme-details">Total : 350‚Ç¨</span>
                            </span>
                            <span class="gamme-price">350‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="100" data-mo="600">
                            <input type="radio" name="CUISINE" value="Complet" onchange="selectModule(this, 100, 600)">
                            <span class="gamme-label">√âvier double + 2 appareils (M: 100‚Ç¨ + MO: 600‚Ç¨)
                                <span class="gamme-details">Total : 700‚Ç¨</span>
                            </span>
                            <span class="gamme-price">700‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="200" data-mo="1100">
                            <input type="radio" name="CUISINE" value="Cuisine Compl√®te" onchange="selectModule(this, 200, 1100)">
                            <span class="gamme-label">Plomberie compl√®te de cuisine neuve (M: 200‚Ç¨ + MO: 1 100‚Ç¨)
                                <span class="gamme-details">Total : 1 300‚Ç¨</span>
                            </span>
                            <span class="gamme-price">1 300‚Ç¨</span>
                        </label>
                    </div>
                </div>
                 <!-- Option 4: Raccordement Gaz -->
                 <div class="option-group">
                    <h3>Raccordement Gaz</h3>
                    <div class="gamme-choice" data-category="GAZ">
                        <label class="gamme-item non-souhaite selected" data-m="0" data-mo="0">
                            <input type="radio" name="GAZ" value="Non Souhait√©" checked onchange="selectModule(this, 0, 0)">
                            <span class="gamme-label">Non souhait√© (Intervention uniquement sur l'eau)</span>
                            <span class="gamme-price">0‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="50" data-mo="350">
                            <input type="radio" name="GAZ" value="Standard" onchange="selectModule(this, 50, 350)">
                            <span class="gamme-label">Raccordement gaz existant (M: 50‚Ç¨ + MO: 350‚Ç¨)
                                <span class="gamme-details">Total : 400‚Ç¨</span>
                            </span>
                            <span class="gamme-price">400‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="150" data-mo="950">
                            <input type="radio" name="GAZ" value="Cr√©ation" onchange="selectModule(this, 150, 950)">
                            <span class="gamme-label">Cr√©ation nouvelle ligne gaz certifi√©e (M: 150‚Ç¨ + MO: 950‚Ç¨)
                                <span class="gamme-details">Total : 1 100‚Ç¨</span>
                            </span>
                            <span class="gamme-price">1 100‚Ç¨</span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="step-subtitle" style="margin-top: 30px;">Douche, Baignoire et Colonne</div>
            <div class="options-grid">
                <!-- Option 5: Type de Douche / Baignoire -->
                <div class="option-group">
                    <h3>Receveur de Douche / Baignoire</h3>
                    <div class="gamme-choice" data-category="DOUCHE_BAIGNOIRE">
                        <label class="gamme-item non-souhaite selected" data-m="0" data-mo="0">
                            <input type="radio" name="DOUCHE_BAIGNOIRE" value="Non Souhait√©" checked onchange="selectModule(this, 0, 0)">
                            <span class="gamme-label">Non souhait√© / Conservation de l'existant</span>
                            <span class="gamme-price">0‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="500" data-mo="1000">
                            <input type="radio" name="DOUCHE_BAIGNOIRE" value="Douche Classique" onchange="selectModule(this, 500, 1000)">
                            <span class="gamme-label">Douche Classique (M: 500‚Ç¨ + MO: 1 000‚Ç¨)
                                <span class="gamme-details">Receveur acrylique, paroi simple</span>
                            </span>
                            <span class="gamme-price">1 500‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="1200" data-mo="1600">
                            <input type="radio" name="DOUCHE_BAIGNOIRE" value="Douche Italienne" onchange="selectModule(this, 1200, 1600)">
                            <span class="gamme-label">Douche Italienne (M: 1 200‚Ç¨ + MO: 1 600‚Ç¨)
                                <span class="gamme-details">Receveur extra-plat √† carreler / Bac r√©sine</span>
                            </span>
                            <span class="gamme-price">2 800‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="600" data-mo="1300">
                            <input type="radio" name="DOUCHE_BAIGNOIRE" value="Baignoire Simple" onchange="selectModule(this, 600, 1300)">
                            <span class="gamme-label">Baignoire Acrylique (M: 600‚Ç¨ + MO: 1 300‚Ç¨)
                                <span class="gamme-details">Standard, avec tablier simple</span>
                            </span>
                            <span class="gamme-price">1 900‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="2500" data-mo="1000">
                            <input type="radio" name="DOUCHE_BAIGNOIRE" value="Baignoire Baln√©o" onchange="selectModule(this, 2500, 1000)">
                            <span class="gamme-label">Baignoire Baln√©o (M: 2 500‚Ç¨ + MO: 1 000‚Ç¨)
                                <span class="gamme-details">Syst√®me hydromassant (raccordement √©lectrique inclus)</span>
                            </span>
                            <span class="gamme-price">3 500‚Ç¨</span>
                        </label>
                    </div>
                </div>
                <!-- Option 6: Colonne de Douche -->
                <div class="option-group">
                    <h3>Robinetterie Douche / Baignoire</h3>
                    <div class="gamme-choice" data-category="COLONNE_DOUCHE">
                         <label class="gamme-item non-souhaite selected" data-m="0" data-mo="0">
                            <input type="radio" name="COLONNE_DOUCHE" value="Non Souhait√©" checked onchange="selectModule(this, 0, 0)">
                            <span class="gamme-label">Non souhait√© / Conservation de l'existant</span>
                            <span class="gamme-price">0‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="100" data-mo="150">
                            <input type="radio" name="COLONNE_DOUCHE" value="Mitigeur Simple + Douchette" onchange="selectModule(this, 100, 150)">
                            <span class="gamme-label">Mitigeur simple (M: 100‚Ç¨ + MO: 150‚Ç¨)
                                <span class="gamme-details">Apparent, douchette et support</span>
                            </span>
                            <span class="gamme-price">250‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="300" data-mo="250">
                            <input type="radio" name="COLONNE_DOUCHE" value="Colonne Thermostatique Apparente" onchange="selectModule(this, 300, 250)">
                            <span class="gamme-label">Colonne Thermostatique (M: 300‚Ç¨ + MO: 250‚Ç¨)
                                <span class="gamme-details">Thermostat de s√©curit√©, ciel de pluie</span>
                            </span>
                            <span class="gamme-price">550‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="500" data-mo="450">
                            <input type="radio" name="COLONNE_DOUCHE" value="Mitigeur Encastr√©" onchange="selectModule(this, 500, 450)">
                            <span class="gamme-label">Mitigeur/Thermostatique Encastr√© (M: 500‚Ç¨ + MO: 450‚Ç¨)
                                <span class="gamme-details">N√©cessite travaux de saign√©e/cloison</span>
                            </span>
                            <span class="gamme-price">950‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="800" data-mo="600">
                            <input type="radio" name="COLONNE_DOUCHE" value="Encastr√© Multi-Jets" onchange="selectModule(this, 800, 600)">
                            <span class="gamme-label">Syst√®me Encastr√© Multi-Jets (M: 800‚Ç¨ + MO: 600‚Ç¨)
                                <span class="gamme-details">4 sorties (Jets, Douchette, Ciel de pluie)</span>
                            </span>
                            <span class="gamme-price">1 400‚Ç¨</span>
                        </label>
                    </div>
                </div>
                 <!-- Option 7: Robinet Lavabo -->
                 <div class="option-group">
                    <h3>Robinet Lavabo / Vasque</h3>
                    <div class="gamme-choice" data-category="ROBINET_LAVABO">
                        <label class="gamme-item non-souhaite selected" data-m="0" data-mo="0">
                            <input type="radio" name="ROBINET_LAVABO" value="Non Souhait√©" checked onchange="selectModule(this, 0, 0)">
                            <span class="gamme-label">Non souhait√© / Conservation de l'existant</span>
                            <span class="gamme-price">0‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="70" data-mo="80">
                            <input type="radio" name="ROBINET_LAVABO" value="Mitigeur Simple" onchange="selectModule(this, 70, 80)">
                            <span class="gamme-label">Mitigeur Simple (M: 70‚Ç¨ + MO: 80‚Ç¨)
                                <span class="gamme-details">Standard chrom√©, pose facile</span>
                            </span>
                            <span class="gamme-price">150‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="200" data-mo="100">
                            <input type="radio" name="ROBINET_LAVABO" value="Mitigeur Haut" onchange="selectModule(this, 200, 100)">
                            <span class="gamme-label">Mitigeur haut / Mural (M: 200‚Ç¨ + MO: 100‚Ç¨)
                                <span class="gamme-details">Pour vasque √† poser ou installation murale</span>
                            </span>
                            <span class="gamme-price">300‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="350" data-mo="150">
                            <input type="radio" name="ROBINET_LAVABO" value="Thermostatique" onchange="selectModule(this, 350, 150)">
                            <span class="gamme-label">Mitigeur Thermostatique (M: 350‚Ç¨ + MO: 150‚Ç¨)
                                <span class="gamme-details">Contr√¥le pr√©cis de la temp√©rature</span>
                            </span>
                            <span class="gamme-price">500‚Ç¨</span>
                        </label>
                    </div>
                </div>
                 <!-- Option 8: Robinetterie Cuisine -->
                 <div class="option-group">
                    <h3>Robinet Cuisine</h3>
                    <div class="gamme-choice" data-category="ROBINET_CUISINE">
                        <label class="gamme-item non-souhaite selected" data-m="0" data-mo="0">
                            <input type="radio" name="ROBINET_CUISINE" value="Non Souhait√©" checked onchange="selectModule(this, 0, 0)">
                            <span class="gamme-label">Non souhait√© / Conservation de l'existant</span>
                            <span class="gamme-price">0‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="90" data-mo="80">
                            <input type="radio" name="ROBINET_CUISINE" value="Mitigeur Simple" onchange="selectModule(this, 90, 80)">
                            <span class="gamme-label">Mitigeur Simple (M: 90‚Ç¨ + MO: 80‚Ç¨)
                                <span class="gamme-details">Bec simple standard</span>
                            </span>
                            <span class="gamme-price">170‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="250" data-mo="100">
                            <input type="radio" name="ROBINET_CUISINE" value="Douchette Extractible" onchange="selectModule(this, 250, 100)">
                            <span class="gamme-label">Mitigeur avec douchette (M: 250‚Ç¨ + MO: 100‚Ç¨)
                                <span class="gamme-details">Flexibilit√© pour lavage √©vier</span>
                            </span>
                            <span class="gamme-price">350‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="500" data-mo="100">
                            <input type="radio" name="ROBINET_CUISINE" value="Filtre Int√©gr√©" onchange="selectModule(this, 500, 100)">
                            <span class="gamme-label">Mitigeur filtration int√©gr√©e (M: 500‚Ç¨ + MO: 100‚Ç¨)
                                <span class="gamme-details">Pour eau potable purifi√©e</span>
                            </span>
                            <span class="gamme-price">600‚Ç¨</span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="step-subtitle" style="margin-top: 30px;">Production d'Eau Chaude (ECS), Vannes et Canalisations</div>
            <div class="options-grid">
                <!-- Option 9: Production d'Eau Chaude (ECS) -->
                <div class="option-group">
                    <h3>Production d'Eau Chaude (ECS)</h3>
                    <div class="gamme-choice" data-category="ECS">
                        <label class="gamme-item non-souhaite selected" data-m="0" data-mo="0">
                            <input type="radio" name="ECS" value="Non Souhait√©" checked onchange="selectModule(this, 0, 0)">
                            <span class="gamme-label">Non souhait√© / Conservation de l'existant</span>
                            <span class="gamme-price">0‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="550" data-mo="450">
                            <input type="radio" name="ECS" value="√âlectrique Standard" onchange="selectModule(this, 550, 450)">
                            <span class="gamme-label">√âlectrique 150L Standard (M: 550‚Ç¨ + MO: 450‚Ç¨)
                                <span class="gamme-details">Ballon simple 150L, pose facile</span>
                            </span>
                            <span class="gamme-price">1 000‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="1500" data-mo="700">
                            <input type="radio" name="ECS" value="Thermodynamique" onchange="selectModule(this, 1500, 700)">
                            <span class="gamme-label">Thermodynamique 200L (M: 1 500‚Ç¨ + MO: 700‚Ç¨)
                                <span class="gamme-details">Pompe √† chaleur int√©gr√©e, √©conomie d'√©nergie</span>
                            </span>
                            <span class="gamme-price">2 200‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="2500" data-mo="1000">
                            <input type="radio" name="ECS" value="Chaudi√®re Gaz" onchange="selectModule(this, 2500, 1000)">
                            <span class="gamme-label">Chaudi√®re Gaz Condensation (M: 2 500‚Ç¨ + MO: 1 000‚Ç¨)
                                <span class="gamme-details">ECS instantan√©e & Chauffage (hors raccordement gaz principal)</span>
                            </span>
                            <span class="gamme-price">3 500‚Ç¨</span>
                        </label>
                    </div>
                </div>
                <!-- Option 10: Mat√©riau de tuyauterie (R√©seau) -->
                <div class="option-group">
                    <h3>R√©seau (Mat√©riau de Tuyauterie)</h3>
                    <div class="gamme-choice" data-category="TUYAUTERIE">
                        <label class="gamme-item non-souhaite selected" data-m="0" data-mo="0">
                            <input type="radio" name="TUYAUTERIE" value="Non Souhait√©" checked onchange="selectModule(this, 0, 0)">
                            <span class="gamme-label">Non souhait√© / Conservation du r√©seau existant</span>
                            <span class="gamme-price">0‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="300" data-mo="700">
                            <input type="radio" name="TUYAUTERIE" value="PER Simple" onchange="selectModule(this, 300, 700)">
                            <span class="gamme-label">PER (M: 300‚Ç¨ + MO: 700‚Ç¨)
                                <span class="gamme-details">Poly√©thyl√®ne R√©ticul√©, simple et rapide</span>
                            </span>
                            <span class="gamme-price">1 000‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="500" data-mo="1000">
                            <input type="radio" name="TUYAUTERIE" value="Multicouche" onchange="selectModule(this, 500, 1000)">
                            <span class="gamme-label">Multicouche (M: 500‚Ç¨ + MO: 1 000‚Ç¨)
                                <span class="gamme-details">Isolation, durabilit√©, moins de dilatation</span>
                            </span>
                            <span class="gamme-price">1 500‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="800" data-mo="1700">
                            <input type="radio" name="TUYAUTERIE" value="Cuivre" onchange="selectModule(this, 800, 1700)">
                            <span class="gamme-label">Cuivre (M: 800‚Ç¨ + MO: 1 700‚Ç¨)
                                <span class="gamme-details">Soudure, r√©sistance maximale, travaux de soudures</span>
                            </span>
                            <span class="gamme-price">2 500‚Ç¨</span>
                        </label>
                    </div>
                </div>
                <!-- Option 11: Vannes et Robinet d'arr√™t -->
                 <div class="option-group">
                    <h3>Vannes et Raccordements</h3>
                    <div class="gamme-choice" data-category="VANNES">
                        <label class="gamme-item non-souhaite selected" data-m="0" data-mo="0">
                            <input type="radio" name="VANNES" value="Existant" checked onchange="selectModule(this, 0, 0)">
                            <span class="gamme-label">Conservation de l'existant</span>
                            <span class="gamme-price">0‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="50" data-mo="150">
                            <input type="radio" name="VANNES" value="Standard" onchange="selectModule(this, 50, 150)">
                            <span class="gamme-label">Ajout de vannes d'arr√™t pour 1-2 appareils (M: 50‚Ç¨ + MO: 150‚Ç¨)
                                <span class="gamme-details">Pour isolation WC/Vasque</span>
                            </span>
                            <span class="gamme-price">200‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="150" data-mo="450">
                            <input type="radio" name="VANNES" value="G√©n√©ral" onchange="selectModule(this, 150, 450)">
                            <span class="gamme-label">Remplacement/Cr√©ation Robinet d'arr√™t g√©n√©ral (M: 150‚Ç¨ + MO: 450‚Ç¨)
                                <span class="gamme-details">Inclut vanne et purge √©ventuelle</span>
                            </span>
                            <span class="gamme-price">600‚Ç¨</span>
                        </label>
                    </div>
                </div>
                <!-- Option 12: Traitement de l'Eau -->
                <div class="option-group">
                    <h3>Traitement de l'Eau (Anti-calcaire)</h3>
                    <div class="gamme-choice" data-category="EAU">
                        <label class="gamme-item non-souhaite selected" data-m="0" data-mo="0">
                            <input type="radio" name="EAU" value="Existant" checked onchange="selectModule(this, 0, 0)">
                            <span class="gamme-label">Non souhait√© / Conservation ou Aucun</span>
                            <span class="gamme-price">0‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="700" data-mo="400">
                            <input type="radio" name="EAU" value="Adoucisseur" onchange="selectModule(this, 700, 400)">
                            <span class="gamme-label">Adoucisseur compact √† r√©sine (M: 700‚Ç¨ + MO: 400‚Ç¨)
                                <span class="gamme-details">Installation sur l'arriv√©e g√©n√©rale</span>
                            </span>
                            <span class="gamme-price">1 100‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="1500" data-mo="400">
                            <input type="radio" name="EAU" value="Osmoseur" onchange="selectModule(this, 1500, 400)">
                            <span class="gamme-label">Osmoseur inverse (M: 1 500‚Ç¨ + MO: 400‚Ç¨)
                                <span class="gamme-details">Eau potable purifi√©e, raccordement √©vier</span>
                            </span>
                            <span class="gamme-price">1 900‚Ç¨</span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="step-subtitle" style="margin-top: 30px;">Travaux Sp√©cifiques (Ouverture, √âvacuation, Accessibilit√©)</div>
            <div class="options-grid">
                <!-- Option 13: D√©pose des √©quipements existants -->
                <div class="option-group">
                    <h3>D√©pose des √âquipements</h3>
                    <div class="gamme-choice" data-category="DEPOSE">
                         <label class="gamme-item non-souhaite selected" data-m="0" data-mo="0">
                            <input type="radio" name="DEPOSE" value="Non Souhait√©" checked onchange="selectModule(this, 0, 0)">
                            <span class="gamme-label">Non souhait√© / Intervention 100% neuve</span>
                            <span class="gamme-price">0‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="0" data-mo="300">
                            <input type="radio" name="DEPOSE" value="Minimal" onchange="selectModule(this, 0, 300)">
                            <span class="gamme-label">Minimal (MO: 300‚Ç¨)
                                <span class="gamme-details">D√©montage facile d'un ou deux √©l√©ments (WC, Vasque)</span>
                            </span>
                            <span class="gamme-price">300‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="0" data-mo="750">
                            <input type="radio" name="DEPOSE" value="Standard" onchange="selectModule(this, 0, 750)">
                            <span class="gamme-label">Standard (MO: 750‚Ç¨)
                                <span class="gamme-details">D√©montage complet SDB ou Cuisine, √©vacuation gravats</span>
                            </span>
                            <span class="gamme-price">750‚Ç¨</span>
                        </label>
                    </div>
                </div>
                <!-- Option 14: Modifications d'√âvacuations -->
                <div class="option-group">
                    <h3>Modifications d'√âvacuations</h3>
                    <div class="gamme-choice" data-category="EVACUATIONS">
                        <label class="gamme-item non-souhaite selected" data-m="0" data-mo="0">
                            <input type="radio" name="EVACUATIONS" value="Minimal" checked onchange="selectModule(this, 0, 0)">
                            <span class="gamme-label">Minimal (Raccordements existants, pas de modification)</span>
                            <span class="gamme-price">0‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="100" data-mo="700">
                            <input type="radio" name="EVACUATIONS" value="Simple" onchange="selectModule(this, 100, 700)">
                            <span class="gamme-label">Simple (M: 100‚Ç¨ + MO: 700‚Ç¨)
                                <span class="gamme-details">D√©placement l√©ger dans la m√™me pi√®ce (moins de 1m)</span>
                            </span>
                            <span class="gamme-price">800‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="250" data-mo="1800">
                            <input type="radio" name="EVACUATIONS" value="Complexe" onchange="selectModule(this, 250, 1800)">
                            <span class="gamme-label">Complexe (M: 250‚Ç¨ + MO: 1 800‚Ç¨)
                                <span class="gamme-details">Cr√©ation de nouvelles colonnes/chutes, travers√©e de mur</span>
                            </span>
                            <span class="gamme-price">2 050‚Ç¨</span>
                        </label>
                    </div>
                </div>
                <!-- Option 15: Sani-broyeur -->
                <div class="option-group">
                    <h3>Sani-Broyeur (WC)</h3>
                    <div class="gamme-choice" data-category="SANIBROYEUR">
                         <label class="gamme-item non-souhaite selected" data-m="0" data-mo="0">
                            <input type="radio" name="SANIBROYEUR" value="Non Souhait√©" checked onchange="selectModule(this, 0, 0)">
                            <span class="gamme-label">Non souhait√© (√âvacuation standard)</span>
                            <span class="gamme-price">0‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="400" data-mo="400">
                            <input type="radio" name="SANIBROYEUR" value="Simple" onchange="selectModule(this, 400, 400)">
                            <span class="gamme-label">Sani-broyeur simple (M: 400‚Ç¨ + MO: 400‚Ç¨)
                                <span class="gamme-details">Installation classique (hors fourniture WC)</span>
                            </span>
                            <span class="gamme-price">800‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="800" data-mo="500">
                            <input type="radio" name="SANIBROYEUR" value="Multi-usages" onchange="selectModule(this, 800, 500)">
                            <span class="gamme-label">Sani-broyeur silencieux (M: 800‚Ç¨ + MO: 500‚Ç¨)
                                <span class="gamme-details">Multi-usages pour SDB compl√®te (hors fourniture WC)</span>
                            </span>
                            <span class="gamme-price">1 300‚Ç¨</span>
                        </label>
                    </div>
                </div>
                 <!-- Option 16: Accessibilit√© (PMR) -->
                <div class="option-group">
                    <h3>Accessibilit√© (PMR/S√©nior)</h3>
                    <div class="gamme-choice" data-category="ACCESSIBILITE">
                        <label class="gamme-item non-souhaite selected" data-m="0" data-mo="0">
                            <input type="radio" name="ACCESSIBILITE" value="Non Souhait√©" checked onchange="selectModule(this, 0, 0)">
                            <span class="gamme-label">Non souhait√© (Installation standard)</span>
                            <span class="gamme-price">0‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="400" data-mo="500">
                            <input type="radio" name="ACCESSIBILITE" value="Simple" onchange="selectModule(this, 400, 500)">
                            <span class="gamme-label">Simple (M: 400‚Ç¨ + MO: 500‚Ç¨)
                                <span class="gamme-details">Barres d'appui, si√®ge de douche mural</span>
                            </span>
                            <span class="gamme-price">900‚Ç¨</span>
                        </label>
                        <label class="gamme-item" data-m="1200" data-mo="1300">
                            <input type="radio" name="ACCESSIBILITE" value="Complet" onchange="selectModule(this, 1200, 1300)">
                            <span class="gamme-label">Complet (M: 1 200‚Ç¨ + MO: 1 300‚Ç¨)
                                <span class="gamme-details">Douche extra-plat PMR, WC rehauss√©, robinet auto</span>
                            </span>
                            <span class="gamme-price">2 500‚Ç¨</span>
                        </label>
                    </div>
                </div>
            </div>
            
        </div>


        <!-- Step 3: Finition Globale (Multiplicateur) -->
        <div class="step" style="margin-top: 50px;">
            <div class="step-title">3. Niveau de Complexit√© Globale (Main-d'≈ìuvre suppl√©mentaire)</div>
            <p class="step-subtitle">Ce coefficient s'applique √† la totalit√© de la main-d'≈ìuvre pour couvrir des d√©fis non pr√©vus (acc√®s, b√¢ti ancien, murs durs, etc.)</p>
            <div class="options-grid" id="gammeGrid">
                <div class="option-card selected" data-name="Complexit√© Standard" data-mult="1" onclick="selectGamme(this, 1)">
                    <div>Standard (Parfaitement adapt√© aux choix ci-dessus)</div>
                    <span class="perimetre-tag">Multiplicateur : x1.0 (0% de suppl√©ment)</span>
                </div>
                <div class="option-card" data-name="Accessibilit√© Difficile" data-mult="1.15" onclick="selectGamme(this, 1.15)">
                    <div>Accessibilit√© Difficile</div>
                    <span class="perimetre-tag">Multiplicateur : x1.15 (+15% sur la MO)</span>
                </div>
                <div class="option-card" data-name="Impr√©vus/D√©fis Techniques" data-mult="1.3" onclick="selectGamme(this, 1.3)">
                    <div>D√©fis Techniques (B√¢ti ancien, mat√©riaux non standard)</div>
                    <span class="perimetre-tag">Multiplicateur : x1.3 (+30% sur la MO)</span>
                </div>
            </div>
        </div>

        <div class="total-box">
            <h3>Estimation indicative TTC (Mat√©riel + Main-d'≈ìuvre)</h3>
            <div class="total-price" id="displayTotal">0‚Ç¨</div>
            <p style="opacity: 0.7; font-size: 14px; margin-top: 10px;">
                Ce montant est une estimation TTC. Il inclut le co√ªt du mat√©riel (Fourniture) et le forfait de pose (Main-d'≈ìuvre).
                <br>Soumis √† visite technique obligatoire pour validation finale.
            </p>
            <br>
            <button class="cta-button" onclick="processDevis()">Prendre RDV pour valider</button>
        </div>
    </div>

    <script>
        // Store all selected module details (price, name, M=Mat√©riel, MO=Main-d'≈ìuvre)
        let selectedModules = {
            // √âtape 1: Le projet principal ne sert qu'√† d√©finir le p√©rim√®tre, pas le prix de base.
            PROJECT: { name: "R√©novation Salle de Bain Compl√®te", price_m: 0, price_mo: 0, total: 0 },
            
            // √âtape 2: Modules d√©taill√©s (initialis√©s √† 0‚Ç¨)
            WC: { name: "WC: Non Souhait√©", price_m: 0, price_mo: 0, total: 0 },
            VASQUE: { name: "Meuble Vasque: Non Souhait√©", price_m: 0, price_mo: 0, total: 0 },
            CUISINE: { name: "Raccordement Cuisine: Non Souhait√©", price_m: 0, price_mo: 0, total: 0 },
            GAZ: { name: "Raccordement Gaz: Non Souhait√©", price_m: 0, price_mo: 0, total: 0 },
            DOUCHE_BAIGNOIRE: { name: "Receveur de Douche / Baignoire: Non Souhait√©", price_m: 0, price_mo: 0, total: 0 },
            COLONNE_DOUCHE: { name: "Robinetterie Douche / Baignoire: Non Souhait√©", price_m: 0, price_mo: 0, total: 0 },
            ROBINET_LAVABO: { name: "Robinet Lavabo: Non Souhait√©", price_m: 0, price_mo: 0, total: 0 },
            ROBINET_CUISINE: { name: "Robinet Cuisine: Non Souhait√©", price_m: 0, price_mo: 0, total: 0 },
            ECS: { name: "Production d'Eau Chaude (ECS): Non Souhait√©", price_m: 0, price_mo: 0, total: 0 },
            TUYAUTERIE: { name: "R√©seau (Mat√©riau de Tuyauterie): Non Souhait√©", price_m: 0, price_mo: 0, total: 0 },
            VANNES: { name: "Vannes et Raccordements: Existant", price_m: 0, price_mo: 0, total: 0 },
            EAU: { name: "Traitement de l'Eau: Existant", price_m: 0, price_mo: 0, total: 0 },
            DEPOSE: { name: "D√©pose des √âquipements: Non Souhait√©", price_m: 0, price_mo: 0, total: 0 },
            EVACUATIONS: { name: "Modifications d'√âvacuations: Minimal", price_m: 0, price_mo: 0, total: 0 },
            SANIBROYEUR: { name: "Sani-Broyeur (WC): Non Souhait√©", price_m: 0, price_mo: 0, total: 0 },
            ACCESSIBILITE: { name: "Accessibilit√© (PMR/S√©nior): Non Souhait√©", price_m: 0, price_mo: 0, total: 0 },
        };
        
        let multiplier = 1; // Multiplicateur de la Gamme (Complexit√© Standard par d√©faut)
        let selectedFinition = "Complexit√© Standard";

        // Initialisation de l'affichage du total au chargement
        window.onload = function() {
            // Set the correct radio button checked attribute and selected class based on the 0‚Ç¨ default
            document.querySelectorAll('.gamme-choice').forEach(group => {
                // Find the default option (usually the first one with 0 total price)
                const defaultRadio = group.querySelector('input[type="radio"][checked]');
                
                // Ensure no other radio is checked and select the 0‚Ç¨ option
                group.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.checked = false;
                    radio.closest('.gamme-item').classList.remove('selected');
                });
                
                if (defaultRadio) {
                    defaultRadio.checked = true;
                    defaultRadio.closest('.gamme-item').classList.add('selected');
                    // Ensure the state in selectedModules is correct based on the initial check
                    const category = group.getAttribute('data-category');
                    // Reset to 0 just in case the initial state setup was missed
                    selectedModules[category] = { 
                        name: selectedModules[category].name, 
                        price_m: 0, 
                        price_mo: 0, 
                        total: 0 
                    };
                }
            });
            
            // Ensure the main project type is selected
            document.querySelector('#typeGrid .option-card').classList.add('selected');
            
            calculate();
        };

        // Function to select the main project (Single Select)
        function selectType(el, price) {
            document.querySelectorAll('#typeGrid .option-card').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
            // Le prix est forc√© √† 0 ici, mais on garde le nom du projet
            selectedModules.PROJECT = {
                name: el.getAttribute('data-name'),
                price_m: 0, 
                price_mo: 0, 
                total: 0 
            };
            calculate();
        }

        // Function to select a module and its range (Radio Group)
        function selectModule(radio, price_m, price_mo) {
            const groupEl = radio.closest('.option-group');
            const category = radio.closest('.gamme-choice').getAttribute('data-category');
            const itemEl = radio.closest('.gamme-item');
            
            const total = price_m + price_mo;

            // Update selection style within the group
            groupEl.querySelectorAll('.gamme-item').forEach(c => c.classList.remove('selected'));
            itemEl.classList.add('selected');

            // Update the selectedModules state
            selectedModules[category] = {
                name: groupEl.querySelector('h3').textContent.replace(/\s*\(.*\)\s*/g, '') + ' / ' + radio.value, // Keep category title clean
                price_m: price_m,
                price_mo: price_mo,
                total: total
            };
            calculate();
        }

        // Function to select the global finish multiplier (Single Select)
        function selectGamme(el, mult) {
            document.querySelectorAll('#gammeGrid .option-card').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
            multiplier = mult;
            selectedFinition = el.getAttribute('data-name');
            calculate();
        }

        // Dynamic Total Calculation Function
        function calculate() {
            let totalMaterialCost = 0; // Co√ªt total des fournitures (Mat√©riel)
            let totalLaborCost = 0;    // Co√ªt total de la main-d'≈ìuvre (Pose)

            // 1. Calculate the sum of all module costs (excluding the PROJECT, which is 0)
            for (const key in selectedModules) {
                if (key !== 'PROJECT' && selectedModules.hasOwnProperty(key)) {
                    totalMaterialCost += selectedModules[key].price_m;
                    totalLaborCost += selectedModules[key].price_mo;
                }
            }
            
            // 2. Apply the global finish multiplier ONLY to the labor cost
            let finalLaborCost = totalLaborCost * multiplier;
            
            // 3. Final Total
            let finalTotal = totalMaterialCost + finalLaborCost;
            
            // Affichage
            document.getElementById('displayTotal').innerText = finalTotal.toLocaleString('fr-FR', { minimumFractionDigits: 0, maximumFractionDigits: 0 }) + "‚Ç¨";
            
            // Logging details to console for transparency (optional, but good for debugging)
            console.log("--- Devis D√©taill√© ---");
            console.log("Co√ªt Mat√©riel (Base): " + totalMaterialCost.toLocaleString('fr-FR') + "‚Ç¨");
            console.log("Co√ªt Main-d'≈ìuvre (Base): " + totalLaborCost.toLocaleString('fr-FR') + "‚Ç¨");
            console.log("Multiplicateur Complexit√©: x" + multiplier);
            console.log("Co√ªt Main-d'≈ìuvre (Final): " + finalLaborCost.toLocaleString('fr-FR') + "‚Ç¨");
            console.log("TOTAL TTC ESTIM√â: " + finalTotal.toLocaleString('fr-FR') + "‚Ç¨");
            console.log("-----------------------");
        }

        // Function to handle webhook and redirection
        function processDevis() {
            calculate();
            
            // Recalculate and gather final data
            let totalMaterialCost = 0;
            let totalLaborCost = 0;
            const modulesDetails = [];

            for (const key in selectedModules) {
                if (key !== 'PROJECT' && selectedModules.hasOwnProperty(key)) {
                    totalMaterialCost += selectedModules[key].price_m;
                    totalLaborCost += selectedModules[key].price_mo;
                    
                    if (selectedModules[key].total > 0) {
                        modulesDetails.push(
                            selectedModules[key].name + 
                            ' (Mat√©riel: ' + selectedModules[key].price_m + '‚Ç¨ + MO: ' + selectedModules[key].price_mo + '‚Ç¨ = Total: ' + selectedModules[key].total + '‚Ç¨)'
                        );
                    } else if (key === 'PROJECT') {
                        // Project scope should always be listed
                         modulesDetails.unshift("P√©rim√®tre du Projet: " + selectedModules[key].name);
                    }
                }
            }
            
            const finalLaborCost = totalLaborCost * multiplier;
            const finalTotal = totalMaterialCost + finalLaborCost;

            // Prepare data to send
            const devisData = {
                projet_principal: selectedModules.PROJECT.name,
                complexite_globale: selectedFinition,
                multiplicateur_complexite: multiplier,
                
                options_selectionnees_detail: modulesDetails, 
                
                cout_materiel_base: totalMaterialCost,
                cout_main_oeuvre_base: totalLaborCost,
                cout_main_oeuvre_final: finalLaborCost,
                estimation_ttc_finale: finalTotal,
                timestamp: new Date().toISOString()
            };

            // URL du webhook Make.com (kept as is)
            const webhookUrl = 'https://hook.eu2.make.com/c665i9hjl2une0jct9og27lj7c3yx3xi';
            
            fetch(webhookUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(devisData),
            })
            .then(response => {
                if (response.ok) {
                    console.log('Webhook Make.com envoy√© avec succ√®s.');
                } else {
                    console.error('Erreur lors de l\'envoi du Webhook Make.com. Statut:', response.status);
                }
            })
            .catch(error => {
                console.error('Erreur r√©seau/fetch:', error);
            })
            .finally(() => {
                // Redirection
                window.location.href = 'intervention.html';
            });
        }
    </script>
</body>
</html>